---
phase: 06-blog-engine
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/blog/Prose.astro
  - src/components/blog/Sidebar.astro
  - src/pages/blog/[id].astro
autonomous: true

must_haves:
  truths:
    - "User can click through to read a full individual blog post"
    - "Blog posts render markdown formatting correctly including inline images"
    - "User sees post metadata (publication date, category/tags) on each post"
    - "User sees author info and related posts in sidebar"
  artifacts:
    - path: "src/components/blog/Prose.astro"
      provides: "Typography wrapper for markdown content"
      contains: "prose"
    - path: "src/components/blog/Sidebar.astro"
      provides: "Author info and related posts sidebar"
      min_lines: 40
    - path: "src/pages/blog/[id].astro"
      provides: "Individual blog post page"
      contains: "render"
  key_links:
    - from: "src/pages/blog/[id].astro"
      to: "astro:content"
      via: "render function"
      pattern: "render.*post"
    - from: "src/components/blog/Sidebar.astro"
      to: "src/data/authors.ts"
      via: "import"
      pattern: "getAuthorById"
---

<objective>
Build individual blog post pages with prose styling, sidebar, and related posts.

Purpose: Enables users to read full blog posts with proper markdown rendering and discover related content.
Output: Working /blog/[id] pages with styled content, author sidebar, and related posts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-blog-engine/06-CONTEXT.md
@.planning/phases/06-blog-engine/06-RESEARCH.md
@.planning/phases/06-blog-engine/06-01-SUMMARY.md

@src/content.config.ts
@src/data/authors.ts
@src/utils/formatDate.ts
@src/layouts/PageLayout.astro
@src/data/services.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Prose wrapper component</name>
  <files>
    src/components/blog/Prose.astro
  </files>
  <action>
    Create Prose.astro:
    - Simple wrapper component using slot
    - Apply Tailwind Typography classes:
      - prose (base typography)
      - prose-lg (slightly larger for readability)
      - dark:prose-invert (CRITICAL for dark mode)
      - max-w-none (let parent control width)
    - Additional prose customizations (optional but nice):
      - prose-headings:font-display (use display font for headings)
      - prose-headings:font-bold
      - prose-a:text-accent-600 dark:prose-a:text-accent-400 (accent links)
      - prose-img:rounded-lg (rounded images)

    Structure:
    ```astro
    <div class="prose prose-lg dark:prose-invert max-w-none
                prose-headings:font-display prose-headings:font-bold
                prose-a:text-accent-600 dark:prose-a:text-accent-400
                prose-img:rounded-lg">
      <slot />
    </div>
    ```
  </action>
  <verify>
    - Component exists with prose classes
    - Includes dark:prose-invert
    - Uses slot for content injection
  </verify>
  <done>
    Prose component provides consistent typography styling for markdown content.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Sidebar component</name>
  <files>
    src/components/blog/Sidebar.astro
  </files>
  <action>
    Create Sidebar.astro:

    Props:
    - authorId: string (from post.data.author)
    - relatedPosts: CollectionEntry<'blog'>[] (max 6)
    - currentCategory: string (for "view more" link context)

    Imports:
    - getAuthorById from '@/data/authors'
    - formatPostDate from '@/utils/formatDate'

    Layout structure:
    1. Sticky container (lg:sticky lg:top-8)
    2. Width: lg:w-64 or lg:w-72

    3. Author Section:
       - Get author = getAuthorById(authorId)
       - Display author name (font-display, font-bold)
       - Display author bio (text-sm, text-surface-500)
       - Optional: author photo placeholder (avatar circle)
       - Subtle separator/divider after

    4. Related Posts Section (if relatedPosts.length > 0):
       - "Related Posts" heading (text-sm, font-semibold, uppercase tracking)
       - List of related posts:
         - Each: link to /blog/{post.id}
         - Title (text-sm, line-clamp-2)
         - Date (text-xs, text-surface-400)
       - If more than 6 related exist (indicated by hasMore prop or just show up to 6):
         - "View more in {category}" link

    5. Gallery Link Section (optional, when post has galleryUrl):
       - Could be passed as prop and rendered if present
       - Or handle in [id].astro and pass to sidebar

    Styling:
    - Surface background with rounded corners
    - Padding (p-4 or p-6)
    - dark:bg-surface-800
    - Space between sections (space-y-6)

    Responsive:
    - Hidden or collapsed on mobile (handled by parent)
    - Sticky on large screens
  </action>
  <verify>
    - Component renders author info from data
    - Related posts display as links
    - Sticky positioning works on desktop
    - Dark mode styling applies
  </verify>
  <done>
    Sidebar displays author info and up to 6 related posts with sticky positioning.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create individual post page</name>
  <files>
    src/pages/blog/[id].astro
  </files>
  <action>
    Create [id].astro:

    1. Imports:
       - getCollection, render from 'astro:content'
       - PageLayout from '@layouts/PageLayout.astro'
       - Prose from '@components/blog/Prose.astro'
       - Sidebar from '@components/blog/Sidebar.astro'
       - formatPostDate from '@/utils/formatDate'
       - Image from 'astro:assets' (for featured image)
       - Button from '@components/ui/Button.astro' (for gallery link)

    2. getStaticPaths:
       ```typescript
       export async function getStaticPaths() {
         const posts = await getCollection('blog');
         return posts.map(post => ({
           params: { id: post.id },
           props: { post },
         }));
       }
       ```

    3. Component script:
       - Get post from Astro.props
       - const { Content } = await render(post)
       - Fetch related posts:
         ```typescript
         const allPosts = await getCollection('blog');
         const relatedPosts = allPosts
           .filter(p => p.data.category === post.data.category && p.id !== post.id)
           .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
           .slice(0, 6);
         ```
       - Get service title for category display (optional, from services.ts)

    4. Layout structure with PageLayout:
       - title={post.data.title}
       - description based on first 160 chars or custom

    5. Article layout (flex with sidebar):
       ```
       <article class="flex flex-col gap-8 lg:flex-row">
         <!-- Main content -->
         <div class="flex-1 min-w-0">
           <!-- Header -->
           <header class="mb-8">
             <!-- Optional featured image -->
             {post.data.featuredImage && (
               <Image src={post.data.featuredImage} alt={...} class="rounded-lg mb-6 w-full" />
             )}
             <h1 class="font-display text-3xl md:text-4xl font-bold mb-4">{post.data.title}</h1>
             <div class="flex flex-wrap items-center gap-4 text-surface-500">
               <time>{formatPostDate(post.data.date)}</time>
               <span class="text-sm bg-surface-100 dark:bg-surface-700 px-2 py-1 rounded">{category}</span>
               {tags && tags.map(tag => <span class="text-sm">#{tag}</span>)}
             </div>
           </header>

           <!-- Content -->
           <Prose>
             <Content />
           </Prose>

           <!-- Gallery CTA if exists -->
           {post.data.galleryUrl && (
             <div class="mt-8 p-6 bg-surface-100 dark:bg-surface-800 rounded-lg">
               <p class="mb-4">View the full gallery from this session:</p>
               <Button href={post.data.galleryUrl} external>View Gallery</Button>
             </div>
           )}
         </div>

         <!-- Sidebar (hidden on mobile, shown on lg) -->
         <aside class="lg:w-72 order-first lg:order-last">
           <Sidebar
             authorId={post.data.author}
             relatedPosts={relatedPosts}
             currentCategory={post.data.category}
           />
         </aside>
       </article>
       ```

    6. Responsive behavior:
       - Desktop: content + sidebar side by side
       - Mobile: sidebar appears first (order-first), then content below
       - Or: hide sidebar on mobile, show only on lg+
  </action>
  <verify>
    - npm run dev and click on a post from /blog
    - Post page loads with title, date, category, tags
    - Markdown content renders with prose styling
    - Headings use display font
    - Links are accent colored
    - Dark mode: prose-invert works (text visible)
    - Sidebar shows author and related posts
    - Gallery button appears if post has galleryUrl
    - Page builds: npm run build
  </verify>
  <done>
    Individual post pages render markdown with typography, sidebar, and gallery links.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Navigate from /blog to individual post - page loads
2. Markdown formatting correct (headings, paragraphs, lists, blockquotes)
3. Author info displays in sidebar
4. Related posts show (same category)
5. Gallery link appears on wedding sample post
6. Sidebar is sticky on desktop scroll
7. Dark mode prose is readable
8. Build succeeds: npm run build
</verification>

<success_criteria>
- Prose component wraps markdown with typography plugin styles
- Dark mode prose is readable (prose-invert applied)
- Sidebar shows author name, bio, and related posts
- Individual post pages at /blog/[id] work
- Featured image renders if present
- Category and tags display
- Gallery CTA button appears when galleryUrl present
- Related posts filtered by same category
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/06-blog-engine/06-03-SUMMARY.md`
</output>
