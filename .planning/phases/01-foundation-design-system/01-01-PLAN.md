---
phase: 01-foundation-design-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - astro.config.mjs
  - package.json
  - tsconfig.json
  - src/styles/global.css
  - src/layouts/BaseLayout.astro
  - src/components/global/ThemeToggle.astro
  - src/env.d.ts
  - .prettierrc
autonomous: true

must_haves:
  truths:
    - "Astro dev server starts without errors"
    - "Tailwind utility classes produce correct CSS output"
    - "Page renders in dark mode by default when no localStorage preference exists"
    - "Theme toggle switches between dark and light mode and persists across page reload without flash"
  artifacts:
    - path: "astro.config.mjs"
      provides: "Astro + Tailwind vite plugin configuration"
      contains: "@tailwindcss/vite"
    - path: "src/styles/global.css"
      provides: "Design tokens and dark mode variant"
      contains: "@custom-variant dark"
    - path: "src/layouts/BaseLayout.astro"
      provides: "HTML shell with inline theme script"
      contains: "script is:inline"
    - path: "src/components/global/ThemeToggle.astro"
      provides: "Dark/light mode toggle button"
      contains: "theme-toggle"
  key_links:
    - from: "src/layouts/BaseLayout.astro"
      to: "src/styles/global.css"
      via: "import '../styles/global.css'"
      pattern: "import.*global\\.css"
    - from: "src/layouts/BaseLayout.astro"
      to: "Fontsource fonts"
      via: "import '@fontsource-variable/*'"
      pattern: "@fontsource-variable"
    - from: "src/styles/global.css"
      to: "Tailwind dark mode"
      via: "@custom-variant dark selector"
      pattern: "@custom-variant dark"
    - from: "src/components/global/ThemeToggle.astro"
      to: "localStorage"
      via: "theme persistence"
      pattern: "localStorage\\.setItem.*theme"
---

<objective>
Scaffold the Astro 5 project with Tailwind CSS v4, establish the complete design token system (terracotta accent palette, warm neutrals, typography), and implement flash-free dark/light mode with a persistent toggle.

Purpose: This is the foundation everything else builds on. Without the project scaffold, design tokens, and theme system, no other plan can execute. The dark mode system is the highest-risk piece in Phase 1 (flash prevention requires exact script placement).

Output: A working Astro dev server with Tailwind v4, complete color/font/spacing design tokens, BaseLayout with inline theme initialization, and a ThemeToggle component. Running `npm run dev` shows a page in dark mode by default with a working toggle.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-design-system/01-CONTEXT.md
@.planning/phases/01-foundation-design-system/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Astro project and install all dependencies</name>
  <files>
    package.json
    astro.config.mjs
    tsconfig.json
    src/env.d.ts
    .prettierrc
  </files>
  <action>
    Create a new Astro project using the minimal template:
    ```
    npm create astro@latest -- --template minimal --no-install .
    ```
    If the directory is not empty (due to .planning, .claude, .git), the command may need the `--yes` flag or manual handling. If Astro scaffolding fails due to non-empty directory, create the files manually following the minimal template structure.

    Install all dependencies:
    ```
    npm install astro tailwindcss@^4.1 @tailwindcss/vite@^4.1 astro-navbar @fontsource-variable/plus-jakarta-sans @fontsource-variable/nunito
    npm install -D prettier prettier-plugin-astro prettier-plugin-tailwindcss
    ```

    Configure astro.config.mjs:
    ```javascript
    import { defineConfig } from "astro/config";
    import tailwindcss from "@tailwindcss/vite";

    export default defineConfig({
      site: "https://simonwickes.com",
      output: "static",
      build: {
        format: "directory",
      },
      vite: {
        plugins: [tailwindcss()],
      },
    });
    ```

    IMPORTANT: Do NOT use `@astrojs/tailwind` integration -- it is deprecated and only supports Tailwind v3. Use `@tailwindcss/vite` in the `vite.plugins` array instead.

    IMPORTANT: Do NOT create a `tailwind.config.js` file. Tailwind v4 uses CSS-first configuration via `@theme` in the CSS file.

    Create .prettierrc:
    ```json
    {
      "plugins": ["prettier-plugin-astro", "prettier-plugin-tailwindcss"],
      "overrides": [
        {
          "files": "*.astro",
          "options": {
            "parser": "astro"
          }
        }
      ]
    }
    ```

    Ensure tsconfig.json extends Astro's strictest preset and add path aliases if helpful.
  </action>
  <verify>
    Run `npm run dev` -- the Astro dev server must start without errors.
    Run `npm run build` -- the build must complete successfully.
    Confirm no `tailwind.config.js` exists.
    Confirm `@astrojs/tailwind` is NOT in package.json.
  </verify>
  <done>
    Astro dev server starts clean. Build completes. All dependencies installed. Config uses @tailwindcss/vite plugin. No deprecated patterns present.
  </done>
</task>

<task type="auto">
  <name>Task 2: Design tokens + BaseLayout with theme script + ThemeToggle</name>
  <files>
    src/styles/global.css
    src/layouts/BaseLayout.astro
    src/components/global/ThemeToggle.astro
    src/pages/index.astro
  </files>
  <action>
    Create src/styles/global.css with the complete design token system:

    ```css
    @import "tailwindcss";

    @custom-variant dark (&:where(.dark, .dark *));

    @theme {
      --font-body: 'Plus Jakarta Sans Variable', ui-sans-serif, system-ui, sans-serif;
      --font-display: 'Nunito Variable', ui-sans-serif, system-ui, sans-serif;

      /* Terracotta/Rust Accent Palette */
      --color-accent-50: #fdf3ef;
      --color-accent-100: #fbe4d9;
      --color-accent-200: #f6c5b2;
      --color-accent-300: #f0a080;
      --color-accent-400: #e87b52;
      --color-accent-500: #c2633e;
      --color-accent-600: #a64e30;
      --color-accent-700: #8a3d27;
      --color-accent-800: #6e3121;
      --color-accent-900: #5a291c;

      /* Warm neutral surface palette */
      --color-surface-50: #faf8f6;
      --color-surface-100: #f5f0eb;
      --color-surface-200: #ebe3da;
      --color-surface-300: #d6cabe;
      --color-surface-400: #b5a596;
      --color-surface-500: #978775;
      --color-surface-600: #7a6b5b;
      --color-surface-700: #5c504a;
      --color-surface-800: #3a322e;
      --color-surface-900: #262120;
      --color-surface-950: #1a1614;

      /* Semantic colors */
      --color-bg-light: #faf8f5;
      --color-bg-dark: #1a1614;
      --color-text-light: #262120;
      --color-text-dark: #f5f0eb;
    }
    ```

    Create src/layouts/BaseLayout.astro:
    - Import Fontsource variable fonts (Plus Jakarta Sans + Nunito)
    - Import global.css
    - Accept `title` and `description` props via Props interface
    - Include the inline theme initialization script as the FIRST script in `<head>` using `<script is:inline>`
    - The script must: check localStorage for 'theme', fall back to system preference via matchMedia, fall back to 'dark' if no preference
    - Apply `.dark` class to `<html>` and set `colorScheme`
    - Body classes: `min-h-screen bg-bg-light font-body text-text-light dark:bg-bg-dark dark:text-text-dark`
    - Include a `<slot />` in body for page content

    CRITICAL: The theme script MUST use `<script is:inline>` to prevent Astro from bundling/deferring it. If bundled, it causes flash of wrong theme on every page load.

    CRITICAL: Do NOT use pure black (#000000) for dark mode background. Use the charcoal/near-black (#1a1614) from design tokens.

    Create src/components/global/ThemeToggle.astro:
    - Button with id="theme-toggle" and aria-label="Toggle dark mode"
    - Sun icon visible in dark mode (class="hidden dark:block"), Moon icon visible in light mode (class="block dark:hidden")
    - Use inline SVG icons for sun and moon
    - Click handler toggles `.dark` class on `<html>`, updates `colorScheme`, saves to localStorage
    - Include `document.addEventListener('astro:after-swap', initThemeToggle)` for future ViewTransitions compatibility
    - Style with warm hover states using surface palette colors

    Update src/pages/index.astro to use BaseLayout and include ThemeToggle for testing:
    - Import BaseLayout, wrap page content
    - Place ThemeToggle visibly on page
    - Add some test content using Tailwind classes (heading with font-display, paragraph with font-body, accent-colored element) to verify design tokens work
    - Include both light and dark mode styled elements so both modes can be visually confirmed
  </action>
  <verify>
    1. Run `npm run dev` and open the page
    2. Verify the page loads in dark mode (charcoal background, light text) when no localStorage theme is set
    3. Click the theme toggle -- page should switch to light mode (cream background, dark text)
    4. Refresh the page -- light mode should persist (no flash of dark mode)
    5. Click toggle back to dark -- refresh again -- dark mode persists
    6. Clear localStorage, set OS to light mode -- page should load in light mode
    7. Clear localStorage, set OS to dark mode (or no preference) -- page should load in dark mode
    8. Verify Tailwind classes work: `text-accent-500` produces terracotta text, `font-display` uses Nunito, `font-body` uses Plus Jakarta Sans
    9. Run `npm run build` -- must complete without errors
  </verify>
  <done>
    Design tokens produce correct Tailwind utility classes. BaseLayout renders with correct fonts and colors. Theme toggle switches modes with smooth transition. Theme preference persists in localStorage. No flash of wrong theme on any page load scenario. Build succeeds.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. `npm run build` completes without errors
3. Page loads in dark mode by default (charcoal background #1a1614)
4. Theme toggle switches between dark and light mode
5. Theme persists across page refresh without flash
6. Tailwind utility classes resolve: `text-accent-500`, `bg-surface-800`, `font-display`, `font-body`
7. `dark:` variant classes work correctly (both toggle-driven and system-preference-driven)
8. No `tailwind.config.js` exists
9. No `@astrojs/tailwind` in dependencies
</verification>

<success_criteria>
- Astro 5 project scaffolded with all Phase 1 dependencies installed
- Tailwind v4 configured via @tailwindcss/vite (no config file, no deprecated integration)
- Complete terracotta/rust accent palette + warm neutral surface palette in @theme
- Plus Jakarta Sans (body) + Nunito (display) fonts self-hosted via Fontsource
- Flash-free dark mode with localStorage persistence and system preference fallback
- Working ThemeToggle component with sun/moon icons
- `npm run dev` and `npm run build` both succeed
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-design-system/01-01-SUMMARY.md`
</output>
