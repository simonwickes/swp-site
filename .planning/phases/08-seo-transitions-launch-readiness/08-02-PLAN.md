---
phase: 08-seo-transitions-launch-readiness
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/layouts/PageLayout.astro
  - src/components/services/ServiceGallery.astro
  - src/components/home/HeroCarousel.astro
  - src/components/home/FeaturedImage.astro
autonomous: true

must_haves:
  truths:
    - "User experiences smooth 200ms fade transition when navigating between pages"
    - "Header and footer stay fixed during page transitions (no flicker)"
    - "Gallery images morph from featured grid to service pages"
    - "Hero carousel pauses during page transitions"
    - "PhotoSwipe lightbox closes immediately when navigating away (back button)"
    - "Users with prefers-reduced-motion see no animations"
  artifacts:
    - path: "src/layouts/PageLayout.astro"
      provides: "Fade transition on main content, persist on Header/Footer"
      contains: "transition:animate"
    - path: "src/components/services/ServiceGallery.astro"
      provides: "PhotoSwipe close on astro:before-preparation"
      contains: "astro:before-preparation"
    - path: "src/components/home/HeroCarousel.astro"
      provides: "Carousel pause during page transitions"
      contains: "astro:before-preparation"
    - path: "src/components/home/FeaturedImage.astro"
      provides: "transition:name for shared element morph"
      contains: "transition:name"
  key_links:
    - from: "src/layouts/PageLayout.astro"
      to: "astro:transitions"
      via: "fade import"
      pattern: "import.*fade.*astro:transitions"
    - from: "src/layouts/PageLayout.astro"
      to: "src/components/global/Header.astro"
      via: "transition:persist"
      pattern: "transition:persist"
    - from: "src/components/home/FeaturedImage.astro"
      to: "service pages"
      via: "transition:name matching"
      pattern: "transition:name"
---

<objective>
Add polished page transitions: 200ms fade on main content, fixed header/footer via transition:persist, shared element morph for gallery images, carousel pause during transitions, and PhotoSwipe close on navigation. This makes the site feel like a native app when browsing between pages.

Purpose: Page transitions create the polished, professional feel expected from a photography portfolio. The fade animation keeps the focus on images while the shared element morph creates a satisfying visual connection between the featured grid and service galleries.

Output: 4 modified files (PageLayout, ServiceGallery, HeroCarousel, FeaturedImage)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-seo-transitions-launch-readiness/08-CONTEXT.md
@.planning/phases/08-seo-transitions-launch-readiness/08-RESEARCH.md
@.planning/phases/08-seo-transitions-launch-readiness/08-01-SUMMARY.md
@src/layouts/PageLayout.astro
@src/components/services/ServiceGallery.astro
@src/components/home/HeroCarousel.astro
@src/components/home/FeaturedImage.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add fade transitions and persist to PageLayout</name>
  <files>
    src/layouts/PageLayout.astro
    src/components/home/FeaturedImage.astro
  </files>
  <action>
  Modify `src/layouts/PageLayout.astro`:

  1. Add import at top of frontmatter:
     ```
     import { fade } from "astro:transitions";
     ```

  2. Expand Props interface to pass through SEO fields to BaseLayout:
     ```typescript
     interface Props {
       title: string;
       description?: string;
       preloadImage?: string;
       ogImage?: string;
       ogType?: "website" | "article";
       article?: {
         publishedTime: string;
         author: string;
       };
     }
     ```
     Destructure all props including ogImage, ogType, article.

  3. Pass all props through to BaseLayout:
     ```astro
     <BaseLayout {title} {description} {preloadImage} {ogImage} {ogType} {article}>
     ```

  4. Add `transition:persist` to Header and Footer with unique identifiers:
     ```astro
     <Header transition:persist="site-header" />
     ```
     ```astro
     <Footer transition:persist="site-footer" />
     ```

  5. Add `transition:animate` to main content with 200ms fade:
     ```astro
     <main class="flex-grow" transition:animate={fade({ duration: '0.2s' })}>
     ```

  Modify `src/components/home/FeaturedImage.astro`:

  1. Add `transition:name` to the Image element using a unique name derived from the href prop. This enables shared element morph when clicking from the featured grid to a service page:
     ```astro
     <Image
       src={image}
       alt={alt}
       class="w-full transition-transform duration-300 group-hover:scale-105"
       loading="lazy"
       width={600}
       transition:name={`featured-${href.replace(/\//g, '-')}`}
     />
     ```

  IMPORTANT: Each transition:name must be unique on the page. Since FeaturedImage is rendered once per service in the grid, using the href ensures uniqueness.

  NOTE on prefers-reduced-motion: Astro's ClientRouter and fade() automatically respect prefers-reduced-motion. No custom CSS or JS needed for this -- it's built into the View Transitions API and Astro's polyfill.
  </action>
  <verify>
  - `npm run build` succeeds
  - `npm run dev` -- navigate between pages and observe fade transition on main content
  - Header and footer should NOT fade/flash during navigation
  - Verify transition:name attributes render in HTML source on the homepage featured grid
  </verify>
  <done>PageLayout applies 200ms fade to main content area. Header and footer persist across navigations. FeaturedImage has transition:name for shared element morph. All SEO props pass through PageLayout to BaseLayout.</done>
</task>

<task type="auto">
  <name>Task 2: Add transition safety to ServiceGallery and HeroCarousel</name>
  <files>
    src/components/services/ServiceGallery.astro
    src/components/home/HeroCarousel.astro
  </files>
  <action>
  Modify `src/components/services/ServiceGallery.astro`:

  Add an `astro:before-preparation` listener that closes any open PhotoSwipe lightbox before the page transition begins. This implements the context decision "Back button navigates directly (closes lightbox immediately if open)."

  In the existing `<script>` block, add this AFTER the `initServiceGallery` function definition and before the initialization calls:

  ```typescript
  // Close lightbox before View Transition navigation
  document.addEventListener('astro:before-preparation', () => {
    if (currentLightbox?.pswp) {
      currentLightbox.pswp.close();
    }
  });
  ```

  This uses the existing `currentLightbox` variable that's already declared at module scope. The `astro:before-preparation` event fires before the transition animation starts, so the lightbox closes instantly before the fade begins.

  Also ensure the existing `astro:page-load` listener is still present (it is -- keep it). The DOMContentLoaded pattern can be simplified now that ClientRouter is active: the `astro:page-load` event fires on both initial load and View Transition navigation. However, keep the existing DOMContentLoaded + immediate pattern for backwards compatibility -- it's harmless and defensive.

  Modify `src/components/home/HeroCarousel.astro`:

  Add an `astro:before-preparation` listener that pauses the Swiper autoplay before page transitions. This prevents visual jank from the carousel sliding while the page is fading out.

  In the existing `<script>` block, add this AFTER the `initHeroCarousel` function definition and BEFORE the initialization calls:

  ```typescript
  // Pause carousel during page transitions to prevent jank
  document.addEventListener('astro:before-preparation', () => {
    const swiperEl = document.getElementById('hero-swiper') as any;
    if (swiperEl?.swiper?.autoplay) {
      swiperEl.swiper.autoplay.stop();
    }
  });
  ```

  This pauses autoplay before the fade-out begins. The carousel will reinitialize via the existing `astro:after-swap` handler when the user returns to the homepage.

  IMPORTANT: Do NOT add transition:persist to the hero section. Let it re-render naturally via the existing `astro:after-swap` handler when navigating back to the homepage. Persisting the carousel across unrelated pages would be incorrect.

  **Also update HeroCarousel alt text** (consolidated from Plan 08-04 to avoid file conflicts):

  Update the `slides` array alt text to follow the SEO pattern "X photography [context] by Simon Wickes". Current alt text is generic (e.g., "Portrait session in golden hour light"). Update to:
  ```typescript
  const slides = [
    {
      src: heroSlide1,
      alt: "Outdoor portrait photography in golden hour light by Simon Wickes",
    },
    {
      src: heroSlide2,
      alt: "Landscape photography at sunset with rolling hills by Simon Wickes",
    },
    {
      src: heroSlide3,
      alt: "Wedding photography capturing a candid celebration moment by Simon Wickes",
    },
    {
      src: heroSlide4,
      alt: "Automotive photography with warm tones and classic car detail by Simon Wickes",
    },
  ];
  ```
  These are placeholder images so the alt text describes the category/mood. When real images replace them, the alt text should be updated with specific locations.
  </action>
  <verify>
  - `npm run build` succeeds
  - `npm run dev` -- open a lightbox on a service page, press browser back button. Lightbox should close and page should transition smoothly.
  - Navigate away from homepage while carousel is playing. Should not see carousel movement during fade-out.
  - Navigate back to homepage. Carousel should reinitialize and work normally.
  - Check homepage hero images: all `<img>` tags should have alt text containing "by Simon Wickes"
  </verify>
  <done>PhotoSwipe lightbox closes before page transitions. Hero carousel pauses during transitions. Hero carousel images have SEO-optimized alt text. Both components handle View Transitions gracefully without visual artifacts.</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds
- Navigate between any two pages: see smooth 200ms fade on content, header/footer stay fixed
- Click featured grid image on homepage: should transition to service page (shared element morph if browser supports View Transitions API natively)
- Open lightbox on service page, press back: lightbox closes, page transitions cleanly
- Homepage carousel does not animate during page exit transition
- Test with prefers-reduced-motion enabled: transitions should be instant/disabled
</verification>

<success_criteria>
- All page navigations use 200ms fade transition on main content
- Header and footer persist (no flash/re-render) across navigations
- FeaturedImage components have unique transition:name attributes
- PhotoSwipe lightbox closes before any page transition
- Hero carousel pauses before page transition begins
- No visual artifacts during any navigation path
</success_criteria>

<output>
After completion, create `.planning/phases/08-seo-transitions-launch-readiness/08-02-SUMMARY.md`
</output>
