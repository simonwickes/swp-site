---
phase: 08-seo-transitions-launch-readiness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/data/seo.ts
  - src/components/seo/SEOHead.astro
  - src/components/seo/Analytics.astro
  - src/components/seo/SchemaLocalBusiness.astro
  - public/robots.txt
  - astro.config.mjs
  - src/layouts/BaseLayout.astro
autonomous: true

must_haves:
  truths:
    - "Every page has a proper title tag, meta description, canonical URL, and Open Graph tags"
    - "Site generates a valid XML sitemap at /sitemap-index.xml"
    - "Site includes JSON-LD LocalBusiness schema on every page"
    - "Google Analytics tracks page views including View Transition navigations"
    - "robots.txt is accessible and references the sitemap"
  artifacts:
    - path: "src/data/seo.ts"
      provides: "Centralized SEO constants (site info, social profiles, GA4 ID, service areas)"
      exports: ["siteInfo", "GA_MEASUREMENT_ID"]
    - path: "src/components/seo/SEOHead.astro"
      provides: "Centralized OG/meta/canonical component"
      min_lines: 30
    - path: "src/components/seo/Analytics.astro"
      provides: "GA4 script with View Transitions tracking via astro:page-load"
      min_lines: 15
    - path: "src/components/seo/SchemaLocalBusiness.astro"
      provides: "Site-wide LocalBusiness + Photographer JSON-LD"
      contains: "application/ld+json"
    - path: "public/robots.txt"
      provides: "Search engine crawl directives"
      contains: "Sitemap:"
    - path: "astro.config.mjs"
      provides: "Sitemap integration"
      contains: "sitemap"
  key_links:
    - from: "src/components/seo/SEOHead.astro"
      to: "Astro.site"
      via: "canonical URL generation"
      pattern: "Astro\\.site|Astro\\.url"
    - from: "src/components/seo/SchemaLocalBusiness.astro"
      to: "src/data/seo.ts"
      via: "import siteInfo"
      pattern: "import.*seo"
    - from: "src/components/seo/Analytics.astro"
      to: "src/data/seo.ts"
      via: "import GA_MEASUREMENT_ID"
      pattern: "GA_MEASUREMENT_ID"
    - from: "src/layouts/BaseLayout.astro"
      to: "src/components/seo/SEOHead.astro"
      via: "component import in head"
      pattern: "SEOHead"
---

<objective>
Create the SEO foundation: data module, metadata components, sitemap, robots.txt, analytics, and LocalBusiness schema. Integrate everything into BaseLayout so every page automatically gets proper SEO metadata, analytics tracking, and structured data. Also add ClientRouter and View Transition lifecycle handlers (theme fix, scroll reset) to BaseLayout since it is being modified.

Purpose: This is the foundation plan that all other Phase 8 plans build on. By handling all BaseLayout modifications in one plan, subsequent plans can work on PageLayout and individual pages in parallel without file conflicts.

Output: 5 new files (seo.ts, SEOHead.astro, Analytics.astro, SchemaLocalBusiness.astro, robots.txt) + 2 modified files (astro.config.mjs, BaseLayout.astro)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-seo-transitions-launch-readiness/08-CONTEXT.md
@.planning/phases/08-seo-transitions-launch-readiness/08-RESEARCH.md
@src/layouts/BaseLayout.astro
@astro.config.mjs
@src/data/services.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SEO data module and all SEO components</name>
  <files>
    src/data/seo.ts
    src/components/seo/SEOHead.astro
    src/components/seo/Analytics.astro
    src/components/seo/SchemaLocalBusiness.astro
    public/robots.txt
  </files>
  <action>
  Create `src/data/seo.ts` with:
  - `siteInfo` object containing: name ("Simon Wickes Photography"), url ("https://simonwickes.com"), description (default meta description for home page: "Professional photographer in Arizona specializing in portraits, weddings, commercial, and landscape photography."), city ("Phoenix"), state ("AZ"), country ("US"), contactPageUrl ("https://simonwickes.com/contact/"), logoUrl ("https://simonwickes.com/og-default.jpg")
  - `socialProfiles` array with placeholder URLs: Instagram ("https://instagram.com/simonwickes"), Facebook ("https://facebook.com/simonwickesphotography") -- add a TODO comment for the user to update these before launch
  - `serviceAreas` array: ["Phoenix", "Scottsdale", "Tempe", "Mesa", "Chandler", "Gilbert"] -- add TODO comment to customize
  - `GA_MEASUREMENT_ID` exported as string, initially empty string `""` with a TODO comment to add the GA4 measurement ID (G-XXXXXXXXXX format)
  - Follow the same module pattern as `src/data/services.ts` (export interface + const + helper)

  Create `src/components/seo/SEOHead.astro` following the RESEARCH.md Pattern 1 exactly:
  - Props: title (string), description (string), ogImage (optional string, defaults to "/og-default.jpg"), ogType (optional "website" | "article", defaults to "website"), article (optional { publishedTime: string, author: string }), canonicalUrl (optional string)
  - Compute canonical from `Astro.url.pathname` and `Astro.site`
  - Compute ogImageUrl as absolute URL
  - Compute fullTitle as `${title} | Simon Wickes Photography` -- EXCEPT when title is "Home", use just "Simon Wickes Photography" (no pipe)
  - Render: `<title>`, `<meta name="description">`, `<link rel="canonical">`, all OG tags (og:type, og:url, og:title, og:description, og:image, og:image:width "1200", og:image:height "630", og:site_name), Twitter card tags (summary_large_image, twitter:title, twitter:description, twitter:image), and conditional article:published_time + article:author if article prop provided
  - Do NOT render `<meta charset>`, `<meta viewport>`, or `<link rel="icon">` -- those stay in BaseLayout

  Create `src/components/seo/Analytics.astro` following RESEARCH.md Example 7:
  - Import `GA_MEASUREMENT_ID` from `@/data/seo`
  - Conditionally render (only if GA_MEASUREMENT_ID is truthy/non-empty)
  - Use `is:inline` on both script tags
  - Use `define:vars={{ GA_MEASUREMENT_ID }}` to pass the ID into the inline script
  - First script: async load gtag.js with the measurement ID
  - Second script: initialize dataLayer, define gtag function, call gtag('js', new Date()) and gtag('config', GA_MEASUREMENT_ID)
  - Add `astro:page-load` listener that sends a page_view event with page_path and page_title (for View Transitions tracking)

  Create `src/components/seo/SchemaLocalBusiness.astro` following RESEARCH.md Example 3:
  - Import `siteInfo`, `socialProfiles`, `serviceAreas` from `@/data/seo`
  - Build schema object with @context, @type "LocalBusiness", additionalType "https://schema.org/Photographer", name, url, description, address (PostalAddress with city/state/country), areaServed (map serviceAreas to City objects + one State "Arizona"), sameAs (socialProfiles), contactPoint (ContactPoint with url to contact page), image (logoUrl)
  - Render via `<script type="application/ld+json" set:html={JSON.stringify(schema)} />`

  Create `public/robots.txt`:
  ```
  User-agent: *
  Allow: /
  Disallow: /api/

  Sitemap: https://simonwickes.com/sitemap-index.xml
  ```
  </action>
  <verify>
  - All 5 files exist and have no TypeScript errors: `npx astro check` (or at minimum `npx tsc --noEmit`)
  - `src/data/seo.ts` exports siteInfo, socialProfiles, serviceAreas, GA_MEASUREMENT_ID
  - `public/robots.txt` contains Sitemap reference
  </verify>
  <done>SEO data module, SEOHead, Analytics, SchemaLocalBusiness components, and robots.txt all created following research patterns. All exports available for downstream plans.</done>
</task>

<task type="auto">
  <name>Task 2: Install sitemap integration and integrate all SEO components into BaseLayout</name>
  <files>
    astro.config.mjs
    src/layouts/BaseLayout.astro
  </files>
  <action>
  Install @astrojs/sitemap:
  ```bash
  npx astro add sitemap --yes
  ```
  This automatically updates astro.config.mjs. After installation, manually verify astro.config.mjs has the sitemap import and integration. Add sitemap configuration with filter and serialize options following RESEARCH.md Example 10:
  - filter: exclude pages containing "/api/" or "/image-test"
  - serialize: blog posts get changefreq "weekly" priority 0.7, service pages get changefreq "monthly" priority 0.8, homepage gets changefreq "weekly" priority 1.0

  Modify `src/layouts/BaseLayout.astro`:

  1. Add imports at top of frontmatter:
     ```
     import { ClientRouter } from "astro:transitions";
     import SEOHead from "@components/seo/SEOHead.astro";
     import Analytics from "@components/seo/Analytics.astro";
     import SchemaLocalBusiness from "@components/seo/SchemaLocalBusiness.astro";
     ```

  2. Expand Props interface to include SEO fields:
     ```typescript
     interface Props {
       title: string;
       description?: string;
       preloadImage?: string;
       ogImage?: string;
       ogType?: "website" | "article";
       article?: {
         publishedTime: string;
         author: string;
       };
     }
     ```
     Destructure the new props with defaults: description defaults to "Professional photography by Simon Wickes" (keep existing), ogImage/ogType/article default to undefined.

  3. In the `<head>`, replace the existing ad-hoc meta description and title tags:
     - REMOVE: `<meta name="description" content={description} />`
     - REMOVE: `<title>{title} | Simon Wickes Photography</title>`
     - ADD (after the favicon link): `<ClientRouter />`
     - ADD: `<SEOHead title={title} description={description} ogImage={ogImage} ogType={ogType} article={article} />`
     - Keep: `<meta charset>`, `<meta viewport>`, `<link rel="icon">`, `preloadImage` conditional, theme inline script
     - ADD (after theme script): `<Analytics />`
     - ADD: `<SchemaLocalBusiness />`

  4. Add View Transition lifecycle handlers at the end of `<body>` (BEFORE the existing theme-ready requestAnimationFrame script):
     ```html
     <script is:inline>
       document.addEventListener('astro:after-swap', function() {
         // Re-apply theme after page swap to prevent flash
         var stored = typeof localStorage !== 'undefined' && localStorage.getItem('theme');
         var theme = (stored === 'dark' || stored === 'light') ? stored :
           (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
         document.documentElement.classList.toggle('dark', theme === 'dark');
         document.documentElement.style.colorScheme = theme;
         // Reset scroll to top
         window.scrollTo({ left: 0, top: 0, behavior: 'instant' });
       });
     </script>
     ```

  5. Keep the existing `theme-ready` requestAnimationFrame script as-is.

  IMPORTANT: The existing theme initialization IIFE in the `<head>` must be preserved exactly as-is. It handles initial page load. The new `astro:after-swap` handler handles subsequent View Transition navigations.
  </action>
  <verify>
  - `npm run build` succeeds without errors
  - Check build output contains sitemap files: `ls dist/sitemap*.xml` should show sitemap-index.xml
  - `npm run dev` and visit homepage -- verify page loads, title tag is correct, no console errors
  - View page source: should contain OG tags, JSON-LD LocalBusiness schema, canonical URL
  </verify>
  <done>Sitemap generates at build time. BaseLayout renders SEOHead (title, meta, OG, canonical), Analytics (GA4 with View Transitions tracking), SchemaLocalBusiness (JSON-LD), and ClientRouter on every page. Theme flash prevention and scroll reset handlers are in place for View Transitions.</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds
- `dist/sitemap-index.xml` exists and references sitemap pages
- `dist/robots.txt` exists with correct content
- View any page source: contains `<title>`, `<meta name="description">`, `<link rel="canonical">`, `og:image`, `application/ld+json` with LocalBusiness schema
- Home page title is "Simon Wickes Photography" (no "Home |" prefix)
- Other pages have "PageTitle | Simon Wickes Photography" format
- GA4 scripts render when GA_MEASUREMENT_ID is set (empty by default, so scripts should NOT render initially)
</verification>

<success_criteria>
- Every page served by the site has proper title, description, canonical, OG tags via SEOHead
- Sitemap auto-generated at build time with correct priorities
- robots.txt accessible at /robots.txt
- LocalBusiness JSON-LD schema present on every page
- ClientRouter enables View Transitions site-wide
- Theme does not flash when navigating between pages in dark mode
- Scroll resets to top on each navigation
- Analytics ready to activate by setting GA_MEASUREMENT_ID in seo.ts
</success_criteria>

<output>
After completion, create `.planning/phases/08-seo-transitions-launch-readiness/08-01-SUMMARY.md`
</output>
