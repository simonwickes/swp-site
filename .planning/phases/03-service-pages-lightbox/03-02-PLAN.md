---
phase: 03-service-pages-lightbox
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/services/ServiceGallery.astro
  - src/styles/global.css
  - src/pages/services/outdoor-portraits.astro
  - src/pages/services/weddings.astro
  - src/pages/services/commercial.astro
  - src/pages/services/landscape.astro
  - src/pages/services/cars.astro
  - src/pages/services/assignments.astro
  - src/pages/services/events.astro
  - src/pages/services/live-performances.astro
  - src/pages/services/index.astro
autonomous: true

must_haves:
  truths:
    - "User can access a dedicated page for each of the 8 service categories"
    - "Each service page shows a responsive masonry gallery grid that adapts from 1 column on mobile to 4 columns on desktop"
    - "User can click any gallery image to view it full-size in a PhotoSwipe lightbox"
    - "Lightbox has keyboard navigation (arrow keys, Escape) and touch swipe support"
    - "Lightbox shows immersive image-only view (no captions, no counter, solid black background)"
    - "Lightbox controls auto-hide after idle period"
    - "No backdrop click close (prevents accidental close)"
    - "Each service page has a hero section with title, description, and CTA button"
    - "Each service page has a horizontal service nav bar for switching categories"
    - "Services index page uses shared data module"
  artifacts:
    - path: "src/components/services/ServiceGallery.astro"
      provides: "Masonry gallery grid with PhotoSwipe lightbox integration"
    - path: "src/pages/services/weddings.astro"
      provides: "Complete service page for Weddings category"
    - path: "src/pages/services/outdoor-portraits.astro"
      provides: "Complete service page for Outdoor Portraits category"
    - path: "src/pages/services/index.astro"
      provides: "Updated services overview using shared data module"
  key_links:
    - from: "src/components/services/ServiceGallery.astro"
      to: "photoswipe"
      via: "script import PhotoSwipeLightbox"
      pattern: "import PhotoSwipeLightbox from.*photoswipe/lightbox"
    - from: "src/components/services/ServiceGallery.astro"
      to: "astro-masonry"
      via: "import { Masonry }"
      pattern: "import.*Masonry.*from.*astro-masonry"
    - from: "src/pages/services/weddings.astro"
      to: "src/components/services/ServiceGallery.astro"
      via: "import ServiceGallery"
      pattern: "import ServiceGallery"
    - from: "src/pages/services/weddings.astro"
      to: "import.meta.glob"
      via: "static glob for weddings images"
      pattern: 'import\\.meta\\.glob.*services/weddings'
---

<objective>
Create the ServiceGallery component (masonry grid + PhotoSwipe lightbox), build all 8 complete service pages replacing the existing stubs, and update the services index page.

Purpose: This is the core deliverable of Phase 3 -- users can browse galleries and view images in a lightbox on every service category page.
Output: `ServiceGallery.astro` component, 8 complete service pages, updated services index, PhotoSwipe CSS overrides.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-service-pages-lightbox/03-CONTEXT.md
@.planning/phases/03-service-pages-lightbox/03-RESEARCH.md
@.planning/phases/03-service-pages-lightbox/03-01-SUMMARY.md
@src/components/services/ServiceHero.astro
@src/components/services/ServiceNav.astro
@src/data/services.ts
@src/components/home/FeaturedGrid.astro (masonry pattern reference)
@src/layouts/PageLayout.astro
@src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ServiceGallery component with PhotoSwipe lightbox and add CSS overrides</name>
  <files>
    src/components/services/ServiceGallery.astro
    src/styles/global.css
  </files>
  <action>
    1. Create `src/components/services/ServiceGallery.astro`:
    - Props: `images: GalleryImage[]` (where GalleryImage has `image: ImageMetadata` and `alt: string`), `galleryId: string`
    - Import `{ Masonry }` from `astro-masonry` and `{ Image }` from `astro:assets`
    - Wrap gallery in a div with `id={galleryId}` and `class="pswp-gallery"`
    - Use Masonry with breakpointCols: `{ default: 4, 1024: 3, 768: 2, 480: 1 }` (context says 1 mobile -> 2 tablet -> 4 desktop)
    - Masonry class: `flex gap-4`, columnClass: `""`
    - Each image wrapped in: `<div class="mb-4"><a href={item.image.src} data-pswp-width={item.image.width} data-pswp-height={item.image.height} class="group block overflow-hidden rounded-lg"><Image src={item.image} alt={item.alt} class="w-full transition-transform duration-300 group-hover:scale-105" loading="lazy" width={600} /></a></div>`
    - The `<a>` tag provides PhotoSwipe with: `href` (full-size URL), `data-pswp-width` (original width), `data-pswp-height` (original height)
    - The `<Image>` provides thumbnail at width=600 for the masonry grid

    2. Add PhotoSwipe initialization `<script>` tag inside ServiceGallery.astro:
    - Import PhotoSwipeLightbox from "photoswipe/lightbox" and "photoswipe/style.css"
    - Use the pattern from 03-RESEARCH.md (Pattern 3 and Code Examples section):
      - Store current lightbox instance for cleanup
      - Destroy previous instance before creating new (View Transitions safety)
      - Gallery selector: ".pswp-gallery", children: "a"
      - Options: bgOpacity: 1, bgClickAction: "none", tapAction: "toggle-controls", imageClickAction: "zoom-or-close", doubleTapAction: "zoom", escKey: true, arrowKeys: true, closeOnVerticalDrag: false, pinchToClose: false, showAnimationDuration: 250, hideAnimationDuration: 250, preload: [1, 2]
      - Hide counter element via `uiRegister` event (set .pswp__counter display: none)
      - Listen on `astro:page-load` event (not DOMContentLoaded)

    3. Add PhotoSwipe CSS overrides to `src/styles/global.css`:
    - Auto-hide controls on idle: `.pswp__ui .pswp__top-bar`, `.pswp__ui .pswp__button--arrow--prev`, `.pswp__ui .pswp__button--arrow--next` get `transition: opacity 0.3s ease`
    - Idle state: `.pswp__ui--idle .pswp__top-bar`, `.pswp__ui--idle .pswp__button--arrow--prev`, `.pswp__ui--idle .pswp__button--arrow--next` get `opacity: 0 !important`
    - Solid black bg: `.pswp { --pswp-bg: #000; }`
    - Hide counter: `.pswp__counter { display: none !important; }`
    - Use plain CSS selectors (not :global -- global.css is already global scope)
  </action>
  <verify>
    - `src/components/services/ServiceGallery.astro` exists with Masonry + PhotoSwipe integration
    - PhotoSwipe script uses `astro:page-load` event
    - `src/styles/global.css` has PhotoSwipe override rules
    - `npx astro check` passes
  </verify>
  <done>ServiceGallery component renders a masonry grid of images where each image opens in a PhotoSwipe lightbox with immersive settings (solid black, no counter, auto-hide controls, no backdrop close). CSS overrides are in global.css.</done>
</task>

<task type="auto">
  <name>Task 2: Build all 8 service pages and update services index</name>
  <files>
    src/pages/services/outdoor-portraits.astro
    src/pages/services/weddings.astro
    src/pages/services/commercial.astro
    src/pages/services/landscape.astro
    src/pages/services/cars.astro
    src/pages/services/assignments.astro
    src/pages/services/events.astro
    src/pages/services/live-performances.astro
    src/pages/services/index.astro
  </files>
  <action>
    1. Replace each of the 8 existing service page stubs with full service pages following this composition pattern (from 03-RESEARCH.md Pattern 5):

    ```astro
    ---
    import PageLayout from "@layouts/PageLayout.astro";
    import ServiceHero from "@components/services/ServiceHero.astro";
    import ServiceNav from "@components/services/ServiceNav.astro";
    import ServiceGallery from "@components/services/ServiceGallery.astro";
    import { getServiceBySlug } from "@/data/services";
    import type { ImageMetadata } from "astro";

    const service = getServiceBySlug("{slug}")!;

    // Static glob -- must be literal string (Vite limitation)
    const imageModules = import.meta.glob<{ default: ImageMetadata }>(
      "/src/assets/images/services/{slug}/*.{jpg,jpeg,png,webp}",
      { eager: true }
    );

    const images = Object.entries(imageModules)
      .sort(([a], [b]) => a.localeCompare(b))
      .map(([_, mod]) => ({
        image: mod.default,
        alt: `${service.title} photography by Simon Wickes`,
      }));
    ---

    <PageLayout title={service.title} description={service.description}>
      <ServiceNav currentSlug="{slug}" />
      <ServiceHero title={service.title} description={service.description} />
      <section class="mx-auto max-w-7xl px-4 pb-16 md:px-6 md:pb-24">
        <ServiceGallery images={images} galleryId="{slug}-gallery" />
      </section>
    </PageLayout>
    ```

    CRITICAL: Each page must have its own static `import.meta.glob` path string. Do NOT use template literals or variables in the glob path -- Vite requires static string literals. For example:
    - weddings.astro: `"/src/assets/images/services/weddings/*.{jpg,jpeg,png,webp}"`
    - outdoor-portraits.astro: `"/src/assets/images/services/outdoor-portraits/*.{jpg,jpeg,png,webp}"`
    - etc.

    The slug in `getServiceBySlug()`, `currentSlug`, and `galleryId` must match the page filename and image directory name.

    Create all 8 pages:
    - outdoor-portraits.astro (slug: "outdoor-portraits")
    - weddings.astro (slug: "weddings")
    - commercial.astro (slug: "commercial")
    - landscape.astro (slug: "landscape")
    - cars.astro (slug: "cars")
    - assignments.astro (slug: "assignments")
    - events.astro (slug: "events")
    - live-performances.astro (slug: "live-performances")

    2. Update `src/pages/services/index.astro`:
    - Replace the inline services array with import from `@/data/services`
    - Keep the existing grid layout and card design
    - Use `service.title` instead of `service.name`, `service.slug` to build href (`/services/${service.slug}/`)
    - Keep the existing description text (short versions) -- import only the `services` array from the data module and map the needed fields
  </action>
  <verify>
    - All 8 service pages exist and are not stubs (no "coming in Phase 3" text)
    - Each page has its own static `import.meta.glob` path (grep for "import.meta.glob" in each file)
    - `src/pages/services/index.astro` imports from `@/data/services`
    - `npx astro build` succeeds and generates all 9 service-related pages
    - Check build output for page count (should include all 8 category pages + index)
  </verify>
  <done>All 8 service pages render with ServiceNav, ServiceHero (title + description + CTA), and ServiceGallery (masonry grid with PhotoSwipe lightbox). Services index page uses the shared data module. Build succeeds.</done>
</task>

</tasks>

<verification>
1. `npx astro build` succeeds
2. Build output shows service pages generated (outdoor-portraits, weddings, commercial, landscape, cars, assignments, events, live-performances)
3. `npx astro preview` -- manually verify one page has working lightbox (click image -> opens fullscreen)
4. Lightbox closes with Escape key, navigates with arrow keys
5. No backdrop click close (click black area does nothing)
6. Controls auto-hide after ~4 seconds idle
7. No counter visible in lightbox
8. ServiceNav shows all 8 categories with current highlighted
9. CTA button links to /contact/
</verification>

<success_criteria>
- All 8 service category pages render with hero section, service nav, and masonry gallery
- Clicking any gallery image opens PhotoSwipe lightbox with immersive settings
- Lightbox supports keyboard (Escape, arrows) and touch (swipe) navigation
- Gallery grid is responsive: 1 column mobile, 2 tablet, 3 medium, 4 desktop
- Each page has a "Contact me" CTA button linking to /contact/
- Horizontal service nav bar shows all 8 categories with current page highlighted
- Services index page uses shared data module
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-service-pages-lightbox/03-02-SUMMARY.md`
</output>
