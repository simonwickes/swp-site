---
interface Props {
  url: string;
  title: string;
}

const { url, title } = Astro.props;

const encodedUrl = encodeURIComponent(url);
const encodedTitle = encodeURIComponent(title);

const xShareUrl = `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`;
const fbShareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;
---

<div class="share-buttons flex items-center gap-3">
  <span class="text-sm text-surface-400 dark:text-surface-500">Share</span>

  {/* X (Twitter) */}
  <a
    href={xShareUrl}
    target="_blank"
    rel="noopener noreferrer"
    aria-label="Share on X"
    class="share-btn inline-flex items-center justify-center w-9 h-9 rounded-full text-surface-500 dark:text-surface-400 hover:text-accent-500 dark:hover:text-accent-400 hover:bg-surface-100 dark:hover:bg-surface-800 transition-colors"
  >
    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
      <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
    </svg>
  </a>

  {/* Facebook */}
  <a
    href={fbShareUrl}
    target="_blank"
    rel="noopener noreferrer"
    aria-label="Share on Facebook"
    class="share-btn inline-flex items-center justify-center w-9 h-9 rounded-full text-surface-500 dark:text-surface-400 hover:text-accent-500 dark:hover:text-accent-400 hover:bg-surface-100 dark:hover:bg-surface-800 transition-colors"
  >
    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
      <path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 1.09.044 1.613.115v3.146c-.427-.044-.72-.065-.82-.065-1.163 0-1.613.442-1.613 1.591v2.771h3.332l-.457 3.667h-2.875v7.98z" />
    </svg>
  </a>

  {/* Instagram (copy to clipboard) */}
  <button
    data-share-instagram
    data-share-url={url}
    aria-label="Share on Instagram"
    class="share-btn inline-flex items-center justify-center w-9 h-9 rounded-full text-surface-500 dark:text-surface-400 hover:text-accent-500 dark:hover:text-accent-400 hover:bg-surface-100 dark:hover:bg-surface-800 transition-colors"
  >
    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
      <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z" />
    </svg>
  </button>

  {/* Copy Link */}
  <button
    data-copy-link
    data-share-url={url}
    aria-label="Copy link"
    class="share-btn inline-flex items-center justify-center w-9 h-9 rounded-full text-surface-500 dark:text-surface-400 hover:text-accent-500 dark:hover:text-accent-400 hover:bg-surface-100 dark:hover:bg-surface-800 transition-colors"
  >
    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
    </svg>
  </button>
</div>

<script>
  function initShareButtons() {
    // Instagram buttons - copy URL to clipboard
    document.querySelectorAll("[data-share-instagram]").forEach((btn) => {
      const button = btn as HTMLButtonElement;
      // Remove old listeners by cloning
      const newBtn = button.cloneNode(true) as HTMLButtonElement;
      button.parentNode?.replaceChild(newBtn, button);

      newBtn.addEventListener("click", async () => {
        const url = newBtn.getAttribute("data-share-url") ?? "";
        try {
          await navigator.clipboard.writeText(url);
          const originalLabel = newBtn.getAttribute("aria-label");
          newBtn.setAttribute("aria-label", "Link copied! Paste on Instagram");
          newBtn.classList.add("text-green-500");
          setTimeout(() => {
            newBtn.setAttribute("aria-label", originalLabel ?? "Share on Instagram");
            newBtn.classList.remove("text-green-500");
          }, 2000);
        } catch {
          prompt("Copy this link:", url);
        }
      });
    });

    // Copy Link buttons - copy URL to clipboard
    document.querySelectorAll("[data-copy-link]").forEach((btn) => {
      const button = btn as HTMLButtonElement;
      const newBtn = button.cloneNode(true) as HTMLButtonElement;
      button.parentNode?.replaceChild(newBtn, button);

      newBtn.addEventListener("click", async () => {
        const url = newBtn.getAttribute("data-share-url") ?? "";
        try {
          await navigator.clipboard.writeText(url);
          const originalLabel = newBtn.getAttribute("aria-label");
          newBtn.setAttribute("aria-label", "Copied!");
          newBtn.classList.add("text-green-500");
          setTimeout(() => {
            newBtn.setAttribute("aria-label", originalLabel ?? "Copy link");
            newBtn.classList.remove("text-green-500");
          }, 2000);
        } catch {
          prompt("Copy this link:", url);
        }
      });
    });
  }

  // Initialize on page load
  // Use DOMContentLoaded for regular navigation, astro:page-load for View Transitions
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initShareButtons);
  } else {
    initShareButtons();
  }

  // Also listen for astro:page-load (View Transitions support)
  document.addEventListener("astro:page-load", initShareButtons);
</script>
