---
import { Image } from "astro:assets";

import heroSlide1 from "@/assets/images/hero/slide-1.jpg";
import heroSlide2 from "@/assets/images/hero/slide-2.jpg";
import heroSlide3 from "@/assets/images/hero/slide-3.jpg";
import heroSlide4 from "@/assets/images/hero/slide-4.jpg";

const slides = [
  {
    src: heroSlide1,
    alt: "Outdoor portrait photography in golden hour light by Simon Wickes",
  },
  {
    src: heroSlide2,
    alt: "Landscape photography at sunset with rolling hills by Simon Wickes",
  },
  {
    src: heroSlide3,
    alt: "Wedding photography capturing a candid celebration moment by Simon Wickes",
  },
  {
    src: heroSlide4,
    alt: "Automotive photography with warm tones and classic car detail by Simon Wickes",
  },
];
---

<section
  class="hero-carousel relative w-full bg-surface-900"
  style="height: 100vh; height: 100dvh;"
  aria-label="Hero image carousel"
>
  <swiper-container
    id="hero-swiper"
    init="false"
    class="h-full w-full"
    loop="true"
    autoplay-delay="4500"
    autoplay-disable-on-interaction="false"
    autoplay-pause-on-mouse-enter="true"
    speed="800"
    navigation="true"
    pagination="true"
    pagination-clickable="true"
  >
    {slides.map((slide, index) => (
      <swiper-slide class="!h-full">
        <div class="relative h-full w-full bg-surface-900">
          <Image
            src={slide.src}
            alt={slide.alt}
            widths={[640, 1024, 1920]}
            sizes="100vw"
            class="h-full w-full object-cover"
            loading={index === 0 ? "eager" : "lazy"}
          />
        </div>
      </swiper-slide>
    ))}
  </swiper-container>

  <!-- Name and tagline overlay -->
  <div class="absolute bottom-8 left-8 z-10 md:bottom-12 md:left-12">
    <h1
      class="font-display text-3xl font-bold text-surface-50 drop-shadow-lg md:text-5xl"
    >
      Simon Wickes Photography
    </h1>
    <p class="mt-2 text-lg text-surface-100 drop-shadow-md md:text-xl">
      Capturing authentic moments
    </p>
  </div>

  <!-- Pause/Play button -->
  <button
    id="hero-pause-btn"
    type="button"
    class="absolute bottom-8 right-8 z-20 flex h-10 w-10 items-center justify-center rounded-full bg-surface-900/50 text-surface-50 transition-colors hover:bg-surface-900/70 md:bottom-12 md:right-12"
    aria-label="Pause carousel"
  >
    <svg
      id="hero-pause-icon"
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="currentColor"
      aria-hidden="true"
    >
      <rect x="6" y="4" width="4" height="16"></rect>
      <rect x="14" y="4" width="4" height="16"></rect>
    </svg>
    <svg
      id="hero-play-icon"
      class="hidden"
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="currentColor"
      aria-hidden="true"
    >
      <polygon points="5,3 19,12 5,21"></polygon>
    </svg>
  </button>
</section>

<script>
  import { register } from "swiper/element";
  import { Autoplay, Navigation, Pagination } from "swiper/modules";

  // Register Swiper web components with only needed modules
  register();

  // Inject modules into swiper element
  const swiperInit = document.getElementById("hero-swiper") as any;
  if (swiperInit) {
    Object.assign(swiperInit, { modules: [Autoplay, Navigation, Pagination] });
    swiperInit.initialize?.();
  }

  function initHeroCarousel() {
    const swiperEl = document.getElementById("hero-swiper") as any;
    const pauseBtn = document.getElementById("hero-pause-btn");
    const pauseIcon = document.getElementById("hero-pause-icon");
    const playIcon = document.getElementById("hero-play-icon");

    if (!swiperEl || !pauseBtn || !pauseIcon || !playIcon) return;

    let isPaused = false;

    // Check reduced motion preference
    const reducedMotion = window.matchMedia(
      "(prefers-reduced-motion: reduce)"
    );

    function pauseCarousel() {
      if (swiperEl.swiper?.autoplay) {
        swiperEl.swiper.autoplay.stop();
      }
      isPaused = true;
      pauseIcon!.classList.add("hidden");
      playIcon!.classList.remove("hidden");
      pauseBtn!.setAttribute("aria-label", "Play carousel");
    }

    function playCarousel() {
      if (swiperEl.swiper?.autoplay) {
        swiperEl.swiper.autoplay.start();
      }
      isPaused = false;
      playIcon!.classList.add("hidden");
      pauseIcon!.classList.remove("hidden");
      pauseBtn!.setAttribute("aria-label", "Pause carousel");
    }

    // Respect prefers-reduced-motion
    function handleReducedMotion(mq: MediaQueryList | MediaQueryListEvent) {
      if (mq.matches) {
        pauseCarousel();
      }
    }

    // Initial check -- use a short delay to let Swiper initialize
    setTimeout(() => {
      handleReducedMotion(reducedMotion);
    }, 100);

    // Listen for preference changes
    reducedMotion.addEventListener("change", handleReducedMotion);

    // Toggle button
    pauseBtn.addEventListener("click", () => {
      if (isPaused) {
        playCarousel();
      } else {
        pauseCarousel();
      }
    });
  }

  // Pause carousel during page transitions to prevent jank
  document.addEventListener('astro:before-preparation', () => {
    const swiperEl = document.getElementById('hero-swiper') as any;
    if (swiperEl?.swiper?.autoplay) {
      swiperEl.swiper.autoplay.stop();
    }
  });

  // Run on initial load
  initHeroCarousel();

  // Re-run on Astro view transitions
  document.addEventListener("astro:after-swap", initHeroCarousel);
</script>

<style>
  /* Swiper web component styling */
  #hero-swiper {
    --swiper-navigation-color: white;
    --swiper-pagination-color: white;
    --swiper-pagination-bullet-inactive-color: white;
    --swiper-pagination-bullet-inactive-opacity: 0.5;
  }

  #hero-swiper::part(button-prev),
  #hero-swiper::part(button-next) {
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
  }

  #hero-swiper::part(pagination) {
    bottom: 5rem !important;
  }

  /* Ensure slides fill container */
  .hero-carousel swiper-slide {
    height: 100% !important;
  }

  /* Respect reduced motion for CSS transitions */
  @media (prefers-reduced-motion: reduce) {
    #hero-swiper {
      --swiper-transition-duration: 0ms;
    }
  }
</style>
